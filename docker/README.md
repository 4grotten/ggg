# Easy Card Database - Docker Deployment

–ü–æ–ª–Ω—ã–π Docker Compose —Å—Ç–µ–∫ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Easy Card –Ω–∞ DigitalOcean Droplet.

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
docker/
‚îú‚îÄ‚îÄ docker-compose.yml      # –û—Å–Ω–æ–≤–Ω–æ–π compose —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .env.example           # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ README.md              # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ init/                  # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    ‚îú‚îÄ‚îÄ 01_extensions.sql  # –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ ENUM —Ç–∏–ø—ã
    ‚îú‚îÄ‚îÄ 02_tables.sql      # –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ 03_functions.sql   # –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
    ‚îú‚îÄ‚îÄ 04_seed_data.sql   # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫—É—Ä—Å—ã, –∫–æ–º–∏—Å—Å–∏–∏, –ª–∏–º–∏—Ç—ã)
    ‚îî‚îÄ‚îÄ 05_rls_policies.sql # Row Level Security –ø–æ–ª–∏—Ç–∏–∫–∏
```

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `profiles` | –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `user_roles` | RBAC —Ä–æ–ª–∏ (admin, moderator, user) |
| `cards` | –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∏ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç—ã |
| `transactions` | –í—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `admin_settings` | –ö—É—Ä—Å—ã, –∫–æ–º–∏—Å—Å–∏–∏, –ª–∏–º–∏—Ç—ã |
| `admin_action_history` | –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ |

### –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

- `top_up` - –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- `withdrawal` - –í—ã–≤–æ–¥
- `transfer_in` - –í—Ö–æ–¥—è—â–∏–π –ø–µ—Ä–µ–≤–æ–¥
- `transfer_out` - –ò—Å—Ö–æ–¥—è—â–∏–π –ø–µ—Ä–µ–≤–æ–¥
- `card_payment` - –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π
- `refund` - –í–æ–∑–≤—Ä–∞—Ç
- `fee` - –ö–æ–º–∏—Å—Å–∏—è
- `cashback` - –ö—ç—à–±—ç–∫
- `card_activation` - –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–∞—Ä—Ç—ã

### –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

| –ü–∞—Ä–∞ | –ü–æ–∫—É–ø–∫–∞ | –ü—Ä–æ–¥–∞–∂–∞ |
|------|---------|---------|
| USDT ‚Üí AED | 3.65 | 3.69 |

### –ö–æ–º–∏—Å—Å–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

| –û–ø–µ—Ä–∞—Ü–∏—è | –ö–æ–º–∏—Å—Å–∏—è |
|----------|----------|
| –ö—Ä–∏–ø—Ç–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | 5.90 USDT (flat) |
| –ë–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ | 1.5% |
| Card-to-Card | 1% |
| –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ | 2% |
| –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã | 1.5% |
| –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ | 183 AED/–≥–æ–¥ |
| –ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ | 183 AED/–≥–æ–¥ |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (DigitalOcean Droplet)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@your_droplet_ip

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker
curl -fsSL https://get.docker.com | sh

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose
apt install docker-compose-plugin -y
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p /opt/easycard
cd /opt/easycard

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã (–∏–ª–∏ –∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
# scp -r docker/* root@your_droplet_ip:/opt/easycard/
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª–∏!
nano .env
```

### 4. –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs -f postgres

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã
ufw allow 22/tcp    # SSH
ufw allow 5432/tcp  # PostgreSQL (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)
ufw enable
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏** –≤ `.env` –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ PostgreSQL (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –∏–ª–∏ SSH —Ç—É–Ω–Ω–µ–ª—å)
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL** –¥–ª—è PostgreSQL
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã**

## üì¶ –ë—ç–∫–∞–ø –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

```bash
docker exec easycard_db pg_dump -U easycard easycard > backup_$(date +%Y%m%d).sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
docker exec -i easycard_db psql -U easycard easycard < backup_20240101.sql
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (cron)

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
0 2 * * * docker exec easycard_db pg_dump -U easycard easycard | gzip > /backups/easycard_$(date +\%Y\%m\%d).sql.gz
```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
docker exec -it easycard_db psql -U easycard

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü
\dt

# –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM admin_settings;

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–£–î–ê–õ–ò–¢ –î–ê–ù–ù–´–ï!)
docker compose down -v
```

## üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```javascript
// –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const connectionString = 'postgresql://easycard:your_password@your_droplet_ip:5432/easycard';

// –° Prisma
DATABASE_URL="postgresql://easycard:your_password@your_droplet_ip:5432/easycard?schema=public"
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### pgAdmin (–≤–∫–ª—é—á–µ–Ω –≤ compose)

- URL: `http://your_droplet_ip:5050`
- Email: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `PGADMIN_EMAIL`
- Password: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `PGADMIN_PASSWORD`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ pgAdmin

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. Right click ‚Üí Register ‚Üí Server
3. Name: `EasyCard DB`
4. Connection:
   - Host: `postgres` (–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
   - Port: `5432`
   - Username: `easycard`
   - Password: –≤–∞—à –ø–∞—Ä–æ–ª—å

## üÜò Troubleshooting

### –ë–∞–∑–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ volume
ls -la /var/lib/docker/volumes/
```

### –û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É (–£–î–ê–õ–ò–¢ –î–ê–ù–ù–´–ï!)
docker compose down -v
docker compose up -d
```

### –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ —Å–Ω–∞—Ä—É–∂–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
ufw status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ binding –≤ docker-compose.yml
# ports: "0.0.0.0:5432:5432"
```
